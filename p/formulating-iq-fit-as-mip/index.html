<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Fun practice of formulating IQ Fit as a mathematical model."><title>🧩 Formulating a game as MIP</title><link rel=canonical href=https://serkankalay.github.io/p/formulating-iq-fit-as-mip/><link rel=stylesheet href=/scss/style.min.ca2ec074f73e9320ec91d209bfa66d4b06a01a738c48a9deedeb2af3571b0067.css><meta property="og:title" content="🧩 Formulating a game as MIP"><meta property="og:description" content="Fun practice of formulating IQ Fit as a mathematical model."><meta property="og:url" content="https://serkankalay.github.io/p/formulating-iq-fit-as-mip/"><meta property="og:site_name" content="Dr. Serkan Kalay"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="MIP"><meta property="article:tag" content="formulation"><meta property="article:published_time" content="2023-10-18T06:25:15+00:00"><meta property="article:modified_time" content="2023-10-18T06:25:15+00:00"><meta property="og:image" content="https://serkankalay.github.io/p/formulating-iq-fit-as-mip/header.jpeg"><meta name=twitter:title content="🧩 Formulating a game as MIP"><meta name=twitter:description content="Fun practice of formulating IQ Fit as a mathematical model."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://serkankalay.github.io/p/formulating-iq-fit-as-mip/header.jpeg"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hud9543b8b32f9cbae6e4924de6c17e097_57472_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Dr. Serkan Kalay</a></h1><h2 class=site-description>🚀 MIP fanatic. ✈️ Aviation geek. 🧑🏻‍🔬 PhD in Operations Research. 👨‍👩‍👧‍👦 Father of two.</h2></div></header><ol class=social-menu><li><a href=https://github.com/serkankalay target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/serkan-kalay/ target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/references/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>References</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#tldr>TL;DR</a></li><li><a href=#background>Background</a></li><li><a href=#understanding-the-game>Understanding the game</a></li><li><a href=#modeling>Modeling</a><ol><li><a href=#variables>Variables</a></li><li><a href=#constraints>Constraints</a></li><li><a href=#objective>Objective</a></li></ol></li><li><a href=#how-to-input-a-challenge>How to input a challenge?</a></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/formulating-iq-fit-as-mip/><img src=/p/formulating-iq-fit-as-mip/header_hua52ff6977716de1b050619b0c037a182_294541_800x0_resize_q75_box.jpeg srcset="/p/formulating-iq-fit-as-mip/header_hua52ff6977716de1b050619b0c037a182_294541_800x0_resize_q75_box.jpeg 800w, /p/formulating-iq-fit-as-mip/header_hua52ff6977716de1b050619b0c037a182_294541_1600x0_resize_q75_box.jpeg 1600w" width=800 height=583 loading=lazy alt="Featured image of post 🧩 Formulating a game as MIP"></a></div><div class=article-details><header class=article-category><a href=/categories/modeling/ style=background-color:#1d85bf;color:#fff>Modeling</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/formulating-iq-fit-as-mip/>🧩 Formulating a game as MIP</a></h2><h3 class=article-subtitle>Fun practice of formulating IQ Fit as a mathematical model.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 18, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h2 id=tldr>TL;DR</h2><p>🧩 <a class=link href=https://smartgames.eu/uk/one-player-games/iq-fit target=_blank rel=noopener>IQ Fit</a> is an award winning 3D puzzle game, which turns out to be a combinatorial problem!</p><p>🧮 You can formulate it as a MIP, a pure Binary Program to be more precise.</p><p>👨‍👧 It is more fun to play it with your daughter/son rather than formulating.</p><h2 id=background>Background</h2><p>A few weeks ago while walking in a toys shop, my daughter showed us a 3D puzzle game.
She told us that she plays with it at school and likes it a lot.</p><p>The idea of the game is, similar to any other puzzle, is pretty straightforward:
you have pieces, and you have a board that you need to completely fill.
The catch is, the pieces are 3D but the board is 2D.
Hence, the player needs to orientate the pieces such that they fill up the board and keep the 2D.</p><p>I found this fabulous <a class=link href=iq-fit_example-899.png>blog post</a> about the game, by Raf Peeters, the designer,
where he explains more.</p><h2 id=understanding-the-game>Understanding the game</h2><p>Let me summarize the facts about the puzzle:</p><ul><li>The board has 50 holes, formed as a 5 by 10 matrix</li><li>There are 10 pieces, each with different color</li><li>Each piece has 2 <em>usable</em> sides</li><li>A challenge is defined by a certain placement of a subset of the pieces and the goal is
to fill up the board entirely with the remaining ones</li></ul><p>Below image shows an example challenge (<em>left</em>) and its solution (<em>right</em>):
<img src=https://www.smartgamesandpuzzles.com/images/iq-fit_example-899.png loading=lazy></p><h2 id=modeling>Modeling</h2><p>As a mathematical optimization practitioner, inevitably I started formulating the game in my mind
as a <em>mathematical optimization model</em> while we played it.
For the general audience, in short:</p><blockquote><p>Mathematical optimization is the process of finding a <strong><em>solution</em></strong> to a <strong><em>problem</em></strong>,
where the <strong><em>solution</em></strong> minimizes (or maximizes) a certain <strong><em>objective</em></strong>.
A mathematical model represents a problem with <strong><em>variables</em></strong>
and <strong><em>constraints</em></strong>. The former correspond to <em>decisions</em> while the latter correspond to actual and/or desired limitations.</p></blockquote><p>Let&rsquo;s start with defining what our decisions are. A way to look at it is as follows:
we select one of the remaining pieces and place it to the board in a <em>certain</em> way.
As defined above, each piece has 2 <em>usable</em> sides.
Raf Peeters provides a beautfiul representation of the pieces as:
<img src=https://www.smartgamesandpuzzles.com/images/iq-fit_puzzle_pieces-874.jpg loading=lazy></p><p>This representation is, however, incomplete for our purposes since it misses the orientation of the side.
Let&rsquo;s take a side of the dark blue piece for instance. You can place it on the board in 4 different orientations:</p><p><img src=/p/formulating-iq-fit-as-mip/dark-blue-orientations.png width=374 height=92 srcset="/p/formulating-iq-fit-as-mip/dark-blue-orientations_hudce923c5b69bcc793589d15e27de45f7_31980_480x0_resize_box_3.png 480w, /p/formulating-iq-fit-as-mip/dark-blue-orientations_hudce923c5b69bcc793589d15e27de45f7_31980_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=406 data-flex-basis=975px></p><h3 id=variables>Variables</h3><p>The player chooses one side and one orientation to place on the board for each piece.
Let $C$ be the set of colors and $O$ be the exhaustive set of combinations of a side and orientation for each color.
Then $o(c)$ will represent a certain color, side and orientation. Let&rsquo;s call $o(c)$ an option of color $c$.</p><p>To represent placement of a piece on the board, let&rsquo;s first determine the way we represent the board itself.
It consists of 50 holes, shaped as a 5 by 10 matrix. Intuitively, we can represent each hole as a point, $(x,y)$.
Let&rsquo;s denote the bottom left as $(0,0)$, namely the origin.</p><p><img src=/p/formulating-iq-fit-as-mip/board.png width=395 height=302 srcset="/p/formulating-iq-fit-as-mip/board_hu7d16d854305ae069f8c0249d3ed770b8_30561_480x0_resize_box_3.png 480w, /p/formulating-iq-fit-as-mip/board_hu7d16d854305ae069f8c0249d3ed770b8_30561_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=130 data-flex-basis=313px></p><p>Our task is to place the pieces onto the board.
For that, having a reference point of $o(c)$, namely the option, would be handy.
We can then relatively express every other <em>ball</em> or <em>point</em> of the option.
Our decision will be: <strong><em>&ldquo;where the reference point
of the option will be placed in the board&rdquo;</em></strong>. Although, this is intuitive for human intelligence,
from mathematical point of view, following is handier:
<strong><em>&ldquo;the reference point of the option is placed to $(x,y)$, or not.&rdquo;</em></strong>. Then our decision variable is:</p><p>$$
x_{o(c),p} =
\begin{cases}
1 &\text{if $o(c)$ is placed at point $p$} \\
0 &\text{otherwise }
\end{cases}
$$</p><p>Let&rsquo;s circle back to the example above and focus on the placement of the dark blue piece.
Below image points which <em>ball</em> we assume to be the reference point and its placement at
$(8,3)$ on the board. Note that it is not possible to place this piece with the same orientation
at $(8,4)$, since one <em>ball</em> will be out of the board.
<img src=/p/formulating-iq-fit-as-mip/example-placement.png width=1211 height=364 srcset="/p/formulating-iq-fit-as-mip/example-placement_hub6bd47daba4c130fdd58440d0e8c2273_158751_480x0_resize_box_3.png 480w, /p/formulating-iq-fit-as-mip/example-placement_hub6bd47daba4c130fdd58440d0e8c2273_158751_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=332 data-flex-basis=798px>
To generate exahustive list of options,
one can determine a reference point for all colors, sides and orientations, enumerate all the points of the board
and check whether the piece fits in the board entirely.</p><h3 id=constraints>Constraints</h3><p>The first rule and the objective of the game is to fill up the board entirely.
In other words, each point on the board needs to have exactly 1 ball assigned to it.
Let&rsquo;s define set $(O,P)(p)$ such that if the reference point of orientation $o(c)$ of color $(c)$
is placed at $p$, then one of the <em>balls</em> of the piece is filling up point $p$.</p><p>In the example above, when the reference point of dark blue piece is placed at $(8,3)$,
following points are filled with dark blue: ${(8,3),(9,3), (9,4), (9,2)}$.
Then, in order to make sure that all the points in the board are filled,
we can express the constraint as follows:</p><p>$$
\sum_{o(c), p&rsquo; \in (O,P)(p))} x_{o(c),p&rsquo;} = 1 \quad \forall p
$$</p><p>Constraints are elements of a mathematical model that determines whether a solution is feasible.
However, counter intuitively, we also need to express the <em>physical</em> restrictions as well.
Anyone playing this game knows by heart that he/she needs to use each piece exactly once.
Below constraint expresses the same thing, only cooler:</p><p>$$
\sum_o x_{o(c),p} = 1 \quad \forall c
$$</p><h3 id=objective>Objective</h3><p>Probably the easiest part is the objective: there is <em>none</em>.
Since we expressed the objective of filling up the entire board as a constraint, the model becomes a feasibility problem.
Hence, we can leave it blank:</p><p>$$
min \quad 0
$$</p><h2 id=how-to-input-a-challenge>How to input a challenge?</h2><p>A challenge is defined as fixed placement of subset of the pieces. Then inputting a challenge to the model
means enforcing those selections. Circling back to the example challenge above, to fix the red piece
we need to fix the variable corresponding to reference point placement to $(1,3)$ as below image illustrates:</p><p><img src=/p/formulating-iq-fit-as-mip/input-challenge.png width=1088 height=373 srcset="/p/formulating-iq-fit-as-mip/input-challenge_hu4a830c7aaa9b82d6ec50aacbf4e095dc_133757_480x0_resize_box_3.png 480w, /p/formulating-iq-fit-as-mip/input-challenge_hu4a830c7aaa9b82d6ec50aacbf4e095dc_133757_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=291 data-flex-basis=700px></p><h2 id=conclusion>Conclusion</h2><p>First of all, kudos to Raf Peeters, for designing this brilliant game. Even though it was a fun
practice to formulate it, to be honest, I prefer playing the challenges with my daughter
and the hardest ones with my wife.
Moreover, even though I formulated it as a mathematical
optimization model, it is rather a feasibility problem since there&rsquo;s no objective to optimize for.
Formulating it as a constraint programming model can be also a good practice, to also touch upon constraint satisfaction phenomenon.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/mip/>MIP</a>
<a href=/tags/formulation/>formulation</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2023 Dr. Serkan Kalay</section><section class=powerby>Know thyself.<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>